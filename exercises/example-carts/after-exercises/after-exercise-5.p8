pico-8 cartridge // http://www.pico-8.com
version 38
__lua__

max_speed = 1.5

function _init()
 needs_missing_map = true
 player = {
  x = 64,
  y = 64,
  dx = 0,
  dy = 0,
  spd = 1,
  jump = 1,
  on_ground = false,
  dead = false
 }
 gen_map(true)
end

function _draw()
 cls()
 camera(player.x-24,0)
 map()
 if (player.dead) then
  camera()
  print("dead!",50,60)
  print("press 🅾️ to try again",20,68)
 	return
 end
 spr(0,player.x,player.y)
end

function _update60()
 local p = player
 -- already dead
 if p.dead then
  if (btnp(🅾️)) then
   _init()
  end
  return
 end
 -- apply death
 if hit(p.x,p.y,7,7,2) then
  p.dead=true
  return
 end
 -- apply gravity
 p.dy=p.dy+0.05
 -- up/ down
 if (btn(➡️)) then
  p.dx=p.dx+0.05
 end
 if (btn(⬅️)) then
  p.dx=p.dx-0.05
 end 

 -- jump
 if btnp(🅾️) and 
   (p.on_ground or p.jump<1) then
   p.on_ground=false
   p.jump+=1
   p.dy=p.dy-2
 end
 
 -- check wall coll
 if hit(p.x+p.dx,p.y,7,7,1) then
  player.dx=0
 end
  
 -- check ground coll
 if hit(p.x,p.y+p.dy,7,7,1) then
  if p.dy>0 then
   p.on_ground=true
  end
   p.dy=0        
 end
 
 -- decel if on ground
 if p.on_ground then
  p.jump=0
 end
 
 -- max acceleration
 if p.dx > max_speed then
  p.dx = max_speed
 end
 
 -- update forward/ upward motion 
 p.y=p.y+p.dy
 p.x=p.x+p.dx
 
 -- reset to beginning
 -- generate more map
 if p.x >= (127-12)*8 then
  p.x = 24
  needs_missing_map = true
  gen_map()
 end
 if needs_missing_map and p.x >= (36-12)*8 then
  gen_missing_map()
  needs_missing_map = false
 end
end
-->8
function hit(x,y,w,h,flag)
 collide=false
  
 for i=x,x+w,w do
  if (fget(mget(i/8,y/8))==flag) or
         (fget(mget(i/8,(y+h)/8))==flag) then
   collide=true
  end
 end
  
 return collide
end
-->8
function gen_map(init)
 -- set flat space at begin
 if (init) then
 	for i=0,15 do
			set_map_x(1,i)
		end
 end
	-- set variable space
	for i=16,111 do
	 local flr_hgt = gen_floor_height()
	 set_map_x(flr_hgt,i)
	 if (flr_hgt > 1 and has_thorns()) then
			mset(i,15-flr_hgt,3)
		end
 end
end

function gen_missing_map()
 for i=0,15 do
  local flr_hgt = gen_floor_height()
		set_map_x(flr_hgt,i)
		set_map_x(flr_hgt,i+112)
	end
end

function gen_floor_height()
 -- negative = no floor
	return rnd(6)-2
end

function has_thorns()
	return rnd(100)-90 > 0
end

-- set a single space on map
function set_map_x(flr_hgt,x)
	-- clear
	for j=0,15 do
  mset(x,j,4)
 end
 for j=0,flr_hgt do
  -- negative nums make no floors
		mset(x,15-j,1)
	end
	-- make lava
	if flr_hgt < 1 then
	 mset(x,15,2)
	end
end
__gfx__
00444400666666660900000060060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
047ff740676556760000900903033060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00ffff006655556600000000003b3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0888888065566556088088800b33bb36000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
088888806556655688888888633bb330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f1111f06655556688a88a880033b3b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100100676556768998999806b33030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05500550666666669999999903333033000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000101000101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000001010101010100000000000001010101010101000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000101010100000000000000000000000000000000000001010100000000000000000000000000000000000000000000000000000001010100000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000101000101010000000000000000000000000000000000000000000000000101000101010101010101010101000000000000000000000001010100000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000101000100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010100000000000001010100000000000000000000000001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000010100000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010101010101010101010100000000000000000000010101000000000000000000000101000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000010101000000000000000000000101000000000000000001010000000000000000000000000001010100000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000101010000000000000000000000000001010101010000000101000000000000000000000000000000000101010101000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010100000000000000000000000000000000000000010101010100000000000000000000000000000000000000000001010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
